"use strict";(self["webpackChunkcaffeineshop"]=self["webpackChunkcaffeineshop"]||[]).push([[937],{4937:function(t,e,o){o.r(e),o.d(e,{default:function(){return $t}});var s=o(6768),l=o(4232),n=o(5130);const a={class:"container"},i={class:"row"},c={class:"col-12"},d={class:"mt-4 mb-4"},r={key:0},u={class:"text-center"},h={key:0},p={class:"col-lg-8 col-md-8 col-sm-12 col-12",ref:"myCart"},k={class:"table align-middle mb-0"},b={class:"py-3",style:{width:"80px"}},f=["src","alt"],m={class:"py-3"},L={class:"py-3",style:{width:"80px"}},v=["onUpdate:modelValue","onChange","disabled"],x={class:"py-3"},g={class:"fs-5 fw-bold"},y={class:"text-end",style:{width:"50px"}},C=["onClick","disabled"],w={class:"col-lg-4 col-md-4 col-sm-12 col-12 text-center position-relative",ref:"checkBox"},B={class:"container"},_={class:"row"},$={class:"col-12"},I={class:"col-12 my-1"},E={class:"border border-warning d-flex p-2"},X={key:0,class:"w-50 text-start"},T={key:0,class:"text-success fs-3 fw-bold"},W={class:"text-danger",style:{"font-size":"1rem"}},S={key:0},F={key:1},M={class:"col-12 mt-1"},D={class:"pb-lg-4 pb-md-4 pd-sm-1 pb-1 btn-group w-100"},N={key:0,type:"button",class:"btn btn-secondary fs-5"},U={class:"d-lg-block d-md-block d-sm-none d-none"},z={key:1,class:"col-12 mt-5"},O={class:"container"},R={class:"row"},J={class:"border d-flex p-2"},P={class:"w-25"},Q=["src","alt"],A={class:"w-75 ps-2 position-relative d-flex"},H=["onClick","disabled"],K={class:"d-flex flex-column justify-content-center",style:{width:"50%"}},Y={class:"fw-bold"},j={class:"fs-5"},V={class:"d-flex flex-column justify-content-center",style:{width:"50%"}},q=["onClick"];function G(t,e,o,G,Z,tt){const et=(0,s.g2)("loading-modal"),ot=(0,s.g2)("router-link"),st=(0,s.g2)("coupon-select");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.bF)(et,{active:Z.isLoading},null,8,["active"]),(0,s.Lk)("div",a,[(0,s.Lk)("div",i,[(0,s.Lk)("div",c,[(0,s.Lk)("div",d,[(0,s.bF)(ot,{to:"/",style:{"text-decoration":"none"}},{default:(0,s.k6)(()=>[...e[2]||(e[2]=[(0,s.eW)("首頁",-1)])]),_:1}),e[3]||(e[3]=(0,s.eW)(" > ",-1)),e[4]||(e[4]=(0,s.Lk)("span",null,"購物車",-1))]),e[5]||(e[5]=(0,s.Lk)("h1",null,"購物車",-1))]),0===Z.num?((0,s.uX)(),(0,s.CE)("div",r,[(0,s.Lk)("p",u,[e[7]||(e[7]=(0,s.eW)(" 購物車內是空的",-1)),e[8]||(e[8]=(0,s.Lk)("br",null,null,-1)),e[9]||(e[9]=(0,s.Lk)("br",null,null,-1)),e[10]||(e[10]=(0,s.eW)("就像你的咖啡杯一樣",-1)),e[11]||(e[11]=(0,s.Lk)("br",null,null,-1)),e[12]||(e[12]=(0,s.Lk)("br",null,null,-1)),(0,s.bF)(ot,{to:"/shopping",class:"no-underline fw-bold btn btn-outline-brown"},{default:(0,s.k6)(()=>[...e[6]||(e[6]=[(0,s.eW)("回商店繼續逛逛",-1)])]),_:1}),e[13]||(e[13]=(0,s.Lk)("br",null,null,-1)),e[14]||(e[14]=(0,s.Lk)("br",null,null,-1)),0!==Z.length?((0,s.uX)(),(0,s.CE)("span",h,"或是直接從下面追蹤清單放入購物車吧！")):(0,s.Q3)("",!0)])])):(0,s.Q3)("",!0),(0,s.bo)((0,s.Lk)("div",p,[(0,s.Lk)("table",k,[e[16]||(e[16]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th"),(0,s.Lk)("th",null,"商品名稱"),(0,s.Lk)("th",null,"單價"),(0,s.Lk)("th",null,"數量"),(0,s.Lk)("th",null,"總額"),(0,s.Lk)("th")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(Z.cart.carts,(o,a)=>((0,s.uX)(),(0,s.CE)("tr",{key:a},[(0,s.Lk)("td",b,[(0,s.Lk)("div",null,[(0,s.Lk)("img",{src:Z.cart.carts[a].product.imageUrl,alt:o.product.title,class:"img-fluid"},null,8,f)])]),(0,s.Lk)("td",m,[(0,s.bF)(ot,{class:"no-underline d-block h-100",to:{name:"product",params:{productId:o.product.id}}},{default:(0,s.k6)(()=>[(0,s.eW)((0,l.v_)(o.product.title),1)]),_:2},1032,["to"])]),(0,s.Lk)("td",null,(0,l.v_)(o.product.price),1),(0,s.Lk)("td",L,[(0,s.bo)((0,s.Lk)("input",{type:"number",class:"form-control","onUpdate:modelValue":t=>o.qty=t,min:"1",max:"20",onChange:t=>tt.updateCart(o,"cart"),disabled:o.id===Z.status.loadingItem},null,40,v),[[n.Jo,o.qty,void 0,{number:!0}]])]),(0,s.Lk)("td",x,[(0,s.Lk)("span",g,(0,l.v_)(t.$num.currency(o.final_total)),1)]),(0,s.Lk)("td",y,[(0,s.Lk)("button",{type:"button",class:"btn btn-outline-danger btn",onClick:t=>tt.deleteCartItem(o.id,"cart"),disabled:o.id===Z.status.loadingItem},[...e[15]||(e[15]=[(0,s.Lk)("i",{class:"bi bi-trash3"},null,-1)])],8,C)])]))),128))])])],512),[[n.aG,0!==Z.num]]),(0,s.bo)((0,s.Lk)("div",w,[(0,s.Lk)("div",{class:(0,l.C4)(["border py-2 bg-white fixedBottomBox",{staticBox:0===Z.boxType,fixedBox:1===Z.boxType,absoluteBox:2===Z.boxType}]),ref:"checkBoxIn"},[(0,s.Lk)("div",B,[(0,s.Lk)("div",_,[(0,s.Lk)("div",$,[(0,s.Lk)("div",{class:(0,l.C4)(["pb-3 fs-3 text-success",{"text-start":Z.cart.total!==Z.cart.final_total}])},[(0,s.Lk)("span",{class:(0,l.C4)([{"fs-3":Z.cart.total==Z.cart.final_total,"fs-6":Z.cart.total!==Z.cart.final_total,"text-decoration-line-through":Z.cart.total!==Z.cart.final_total}])},[(0,s.eW)("合計 "+(0,l.v_)(t.$num.currency(Z.cart.total))+" 元",1),e[17]||(e[17]=(0,s.Lk)("br",null,null,-1))],2)],2)]),(0,s.Lk)("div",I,[(0,s.Lk)("div",E,[Z.cart.total!==Z.cart.final_total?((0,s.uX)(),(0,s.CE)("div",X,[Z.cart.total!==Z.cart.final_total?((0,s.uX)(),(0,s.CE)("span",T,[(0,s.eW)("合計 "+(0,l.v_)(t.$num.currency(Z.cart.final_total))+" 元",1),e[18]||(e[18]=(0,s.Lk)("br",null,null,-1)),(0,s.Lk)("span",W,"已套用 "+(0,l.v_)(tt.unitsDigit(Z.cart.carts[0].coupon.percent))+"折 優惠券",1)])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{class:(0,l.C4)(["pb-2",{"w-100":Z.cart.total==Z.cart.final_total,"w-50":Z.cart.total!==Z.cart.final_total}])},[(0,s.Lk)("button",{type:"button",class:"btn btn-outline-warning",onClick:e[0]||(e[0]=(0,n.D$)((...t)=>tt.openCouponModal&&tt.openCouponModal(...t),["prevent"]))},[Z.cart.total==Z.cart.final_total?((0,s.uX)(),(0,s.CE)("span",S,"查看優惠券")):((0,s.uX)(),(0,s.CE)("span",F,"其他優惠券")),e[19]||(e[19]=(0,s.Lk)("i",{class:"bi bi-ticket-perforated-fill"},null,-1))])],2)])]),(0,s.Lk)("div",M,[(0,s.Lk)("div",D,[0===Z.num?((0,s.uX)(),(0,s.CE)("button",N," 購物車內沒有商品 ")):((0,s.uX)(),(0,s.CE)("button",{key:1,type:"button",class:"btn btn-danger fs-5",onClick:e[1]||(e[1]=(...t)=>tt.goToCheck&&tt.goToCheck(...t))}," 前往結帳 "))]),(0,s.Lk)("div",U,[e[21]||(e[21]=(0,s.eW)(" 或是...",-1)),e[22]||(e[22]=(0,s.Lk)("br",null,null,-1)),(0,s.bF)(ot,{to:"/shopping",class:"no-underline fw-bold"},{default:(0,s.k6)(()=>[...e[20]||(e[20]=[(0,s.eW)("回商店繼續逛逛",-1)])]),_:1})])])])])],2)],512),[[n.aG,0!==Z.num]]),0!==Z.length?((0,s.uX)(),(0,s.CE)("div",z,[e[26]||(e[26]=(0,s.Lk)("p",{class:"fw-bold fs-4"},"追蹤清單內尚有商品",-1)),(0,s.Lk)("div",O,[(0,s.Lk)("div",R,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(tt.filterData,(t,o)=>((0,s.uX)(),(0,s.CE)("div",{class:(0,l.C4)(["col-lg-6 col-md-6 col-sm-12 col-12 mb-2",{fadeOut:this.favorNum===o}]),key:o},[(0,s.Lk)("div",J,[(0,s.Lk)("div",P,[(0,s.bF)(ot,{class:"no-underline text-dark",to:{name:"product",params:{productId:t.id}}},{default:(0,s.k6)(()=>[(0,s.Lk)("img",{src:tt.filterData[o].imageUrl,class:"img-fluid",alt:t.title},null,8,Q)]),_:2},1032,["to"])]),(0,s.Lk)("div",A,[(0,s.Lk)("button",{class:"btn btn-outline-danger btn-sm position-absolute top-0 end-0",type:"button",style:{"font-size":"0.6rem"},onClick:(0,n.D$)(e=>tt.deleteFavorite(t.id,o),["prevent"]),disabled:Z.favorNum!==o&&""!==Z.favorNum},[...e[23]||(e[23]=[(0,s.Lk)("i",{class:"bi bi-x-lg"},null,-1)])],8,H),(0,s.Lk)("div",K,[(0,s.bF)(ot,{class:"no-underline text-dark",to:{name:"product",params:{productId:t.id}}},{default:(0,s.k6)(()=>[(0,s.Lk)("span",Y,[(0,s.eW)((0,l.v_)(t.title),1),e[24]||(e[24]=(0,s.Lk)("br",null,null,-1)),(0,s.Lk)("span",j,(0,l.v_)(t.price)+" 元",1)])]),_:2},1032,["to"])]),(0,s.Lk)("div",V,[(0,s.Lk)("button",{type:"button",class:"btn btn-brown w-75",onClick:e=>tt.addProduct(t.id,o,"cart")},[...e[25]||(e[25]=[(0,s.Lk)("i",{class:"bi bi-cart-fill"},null,-1)])],8,q)])])])],2))),128))])])])):(0,s.Q3)("",!0)])]),(0,s.bF)(st,{ref:"couponModal",usedCoupon:Z.usedCoupon,onSendCoupon:tt.couponUse},null,8,["usedCoupon","onSendCoupon"])],64)}o(4114),o(8111),o(7588),o(3110),o(8335);var Z=o(1600);const tt={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},et={class:"modal-dialog",role:"document"},ot={class:"modal-content"},st={class:"modal-body"},lt={key:0,class:"mb-3"},nt={class:"p-3"},at={class:"card-body d-flex flex-lg-nowrap flex-md-nowrap flex-sm-wrap flex-wrap flex-lg-row flex-md-row flex-sm-column flex-column position-relative"},it={class:"couponTitle"},ct={class:"card-title"},dt={class:"card-text"},rt={class:"couponDate"},ut={class:"card-text text-sm"},ht={class:"couponBtn btn-group float-lg-none float-md-none float-sm-end float-end"},pt=["disabled","onClick"],kt={key:0},bt={key:1},ft={class:"mb-3 px-3"},mt={class:"modal-footer px-3"};function Lt(t,e,o,a,i,c){return(0,s.uX)(),(0,s.CE)("div",tt,[(0,s.Lk)("div",et,[(0,s.Lk)("div",ot,[e[5]||(e[5]=(0,s.Lk)("div",{class:"modal-header bg-brown text-white"},[(0,s.Lk)("h5",{class:"modal-title",id:"exampleModalLabel"},"優惠券"),(0,s.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),(0,s.Lk)("div",st,[0!==i.couponList.length?((0,s.uX)(),(0,s.CE)("div",lt,[e[2]||(e[2]=(0,s.Lk)("span",{class:"d-block px-3"},"直接點選優惠券即可帶入購物車",-1)),(0,s.Lk)("div",nt,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(i.couponList,(e,n)=>((0,s.uX)(),(0,s.CE)("div",{class:"card mb-3",key:n},[(0,s.Lk)("div",at,[(0,s.Lk)("div",it,[(0,s.Lk)("h5",ct,(0,l.v_)(e.name),1),(0,s.Lk)("p",dt,"全品項 "+(0,l.v_)(c.unitsDigit(e.percent))+" 折",1)]),(0,s.Lk)("div",rt,[(0,s.Lk)("p",ut,"到期日 "+(0,l.v_)(t.$num.date(e.due_date)),1)]),(0,s.Lk)("div",ht,[(0,s.Lk)("button",{type:"button",disabled:e.code===o.usedCoupon,class:"btn btn-warning",onClick:t=>c.couponUse(e.code)},[e.code===o.usedCoupon?((0,s.uX)(),(0,s.CE)("span",kt,"已使用")):((0,s.uX)(),(0,s.CE)("span",bt,"使用"))],8,pt)])])]))),128))]),e[3]||(e[3]=(0,s.Lk)("span",{class:"d-block px-3"},"或是由下方輸入優惠碼",-1))])):(0,s.Q3)("",!0),(0,s.Lk)("div",ft,[(0,s.bo)((0,s.Lk)("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":e[0]||(e[0]=t=>i.coupon_code=t),placeholder:"請輸入優惠碼"},null,512),[[n.Jo,i.coupon_code]])])]),(0,s.Lk)("div",mt,[(0,s.eW)((0,l.v_)(i.coupon_code)+" ",1),e[4]||(e[4]=(0,s.Lk)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close",-1)),(0,s.Lk)("button",{type:"button",class:"btn btn-primary",onClick:e[1]||(e[1]=t=>c.couponUse(""))},"套用優惠碼")])])])],512)}var vt=o(3286),xt={name:"CouponSelect",data(){return{couponList:[{name:"15%OFF優惠券",percent:85,code:"15percentoff",due_date:1785456e3},{name:"開幕優惠券",percent:40,code:"newOpenShop",due_date:1790726400}],coupon_code:""}},mixins:[vt.A],props:{usedCoupon:{default(){return{}}}},methods:{couponUse(t){t&&(this.coupon_code=t),this.usedCoupon!==this.coupon_code?""!==this.coupon_code?(this.$emit("send-coupon",this.coupon_code),this.coupon_code="",this.hideModal()):alert("請輸入優惠碼！"):alert("此優惠券已經使用！")},unitsDigit(t){return t%10===0?t/10:t}}},gt=o(1241);const yt=(0,gt.A)(xt,[["render",Lt]]);var Ct=yt,wt=o(5306),Bt={name:"CartPage",data(){return{cart:{},getIt:"",num:0,status:{loadingItem:""},err:!1,productList:[],length:0,favorite:JSON.parse(localStorage.getItem("favoriteList"))||[],favorNum:"",boxType:0,usedCoupon:"",isLoading:!1,checkBoxWidth:0,checkBoxInHeight:0,checkBoxLeft:0,myCartBottom:0,observer:null}},components:{CouponSelect:Ct},methods:{getCart:wt.Xl,updateCart:wt.iH,deleteCartItem:wt.FD,goToCheck(){this.$router.push("/checkout")},async allProducts(){try{const t=await(0,wt.AS)(this.$http);this.productList=t}catch(t){this.$InformMessage(t,"取得商品")}},deleteFavorite(t,e){const o=this.favorite.indexOf(t);this.favorNum=e,setTimeout(()=>{this.favorNum="",this.favorite.splice(o,1),localStorage.setItem("favoriteList",JSON.stringify(this.favorite))},500)},async addProduct(t,e,o){const s=this.favorite.indexOf(t);this.favorNum=e,await new Promise(t=>setTimeout(t,1e3)),this.favorNum="",this.favorite.splice(s,1),localStorage.setItem("favoriteList",JSON.stringify(this.favorite));try{const e=await(0,wt.bE)(this.$http,t,1,o);console.log(e),this.$InformMessage(e,"商品放入購物車"),this.getCart("cart")}catch(l){this.$InformMessage(l.message)}},openCouponModal(){this.$refs.couponModal.showModal()},async couponUse(t){this.$refs.couponModal.hideModal(),this.isLoading=!0;try{const e=await(0,wt.Jj)(t,this.$http);if(e.data.success)this.getCart("cart");else if(!e.data.success)throw e;this.isLoading=!1}catch(e){this.isLoading=!1,this.$InformMessage(e,"添加優惠券")}},handleScroll(){const t=this.$refs.checkBox,e=this.$refs.checkBoxIn;this.checkBoxLeft=t.getBoundingClientRect().x,this.checkBoxWidth=t.getBoundingClientRect().width,window.innerWidth>768&&(window.scrollY<=72&&1===this.boxType?this.boxType=0:window.scrollY>72&&window.scrollY<this.myCartBottom-this.checkBoxInHeight+50&&(0===this.boxType||2===this.boxType)?(this.boxType=1,e.style.left=`${this.checkBoxLeft+12}px`,e.style.width=this.checkBoxWidth-24+"px"):window.scrollY>this.myCartBottom-this.checkBoxInHeight+50&&1===this.boxType&&(this.boxType=2,e.style.width=this.checkBoxWidth-24+"px"))},unitsDigit(t){return t%10===0?t/10:t}},computed:{filterData(){const t=[],e=this.favorite.length;return this.productList.forEach(o=>{for(let s=0;s<e;s++)o.id===this.favorite[s]&&t.push(o)}),t}},watch:{filterData(t,e){this.length=t.length},checkBoxLeft(t,e){const o=this.$refs.checkBoxIn;t!==e&&(o.style.left=`${t+12}px`)}},created(){this.allProducts(),Z.A.on("updateCart",()=>{this.getCart("cart")})},mounted(){this.$nextTick(async()=>{const t=await this.getCart("cart");if(window.addEventListener("scroll",this.handleScroll),0!==t){const t=this.$refs.checkBox,e=this.$refs.checkBoxIn,o=this.$refs.myCart;this.checkBoxLeft=t.getBoundingClientRect().x,this.checkBoxInHeight=e.getBoundingClientRect().height,this.myCartBottom=o.getBoundingClientRect().bottom,window.addEventListener("resize",()=>{window.innerWidth<=768?this.lessThan768=!0:this.lessThan768=!1}),this.observer=new ResizeObserver(o=>{for(const s of o){const o=s.borderBoxSize?s.borderBoxSize[0].inlineSize:s.contentRect.width;this.checkBoxWidth=o,this.checkBoxLeft=t.getBoundingClientRect().x,e.style.width=this.checkBoxWidth-24+"px"}}),this.$refs.checkBox&&this.observer.observe(this.$refs.checkBox)}})},unmounted(){window.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.windowSize)}};const _t=(0,gt.A)(Bt,[["render",G]]);var $t=_t}}]);
//# sourceMappingURL=937.eda11b1c.js.map